{{!-- Admin Payroll Queries --}}
<div class="container-fluid">
	<div class="row">
		<div class="col-md-3 col-lg-2 px-0">
			{{> sidebar active="payroll-queries" activeGroup="workspace"}}
		</div>

		<div class="col-md-9 col-lg-10">
			<div class="main-content p-4">
				<nav aria-label="breadcrumb">
					<ol class="breadcrumb mb-3 bg-transparent p-0">
						<li class="breadcrumb-item"><a href="/dashboard">Dashboard</a></li>
						<li class="breadcrumb-item active" aria-current="page">Payroll Queries</li>
					</ol>
				</nav>

				<div class="d-flex align-items-center justify-content-between mb-4">
					<div>
						<h2 class="mb-1">Payroll Queries</h2>
						<p class="text-muted mb-0">Support tickets from employees regarding payroll</p>
					</div>
				</div>

				<!-- Filters -->
				<div class="card mb-4">
					<div class="card-body">
						<div class="row g-3">
							<div class="col-md-3">
								<label class="form-label small fw-600">Status</label>
								<select class="form-select form-select-sm" onchange="filterQueries()">
									<option value="">All Statuses</option>
									<option value="OPEN">Open</option>
									<option value="IN_PROGRESS">In Progress</option>
									<option value="RESOLVED">Resolved</option>
									<option value="CLOSED">Closed</option>
								</select>
							</div>
							<div class="col-md-3">
								<label class="form-label small fw-600">Category</label>
								<select class="form-select form-select-sm" onchange="filterQueries()">
									<option value="">All Categories</option>
									<option value="MISMATCH">Salary Mismatch</option>
									<option value="TAX">Tax Related</option>
									<option value="REIMBURSEMENT">Reimbursement</option>
									<option value="OTHER">Other</option>
								</select>
							</div>
							<div class="col-md-3">
								<label class="form-label small fw-600">Assignee</label>
								<select class="form-select form-select-sm" onchange="filterQueries()">
									<option value="">All Users</option>
									<option value="UNASSIGNED">Unassigned</option>
									<option value="me">Assigned to Me</option>
									<option value="hrmanager">HR Manager</option>
									<option value="finmanager">Finance Manager</option>
								</select>
							</div>
							<div class="col-md-3 d-flex align-items-end">
								<button class="btn btn-sm btn-outline-secondary w-100" onclick="resetFilters()">
									<i class="fa-solid fa-rotate-left me-1"></i>Reset
								</button>
							</div>
						</div>
					</div>
				</div>

				<div class="row g-3">
					<!-- Query List (Left Column) -->
					<div class="col-md-4">
						<div class="card">
							<div class="card-header">
								<h6 class="mb-0">Queries <span class="badge bg-secondary ms-2">{{queries.length}}</span></h6>
							</div>
							<div class="card-body p-0">
								{{#if queries.length}}
									<div class="list-group list-group-flush">
										{{#each queries}}
										<a href="#" class="list-group-item list-group-item-action p-3 query-item" data-id="{{this.id}}" onclick="selectQuery({{this.id}}); return false;">
											<div class="d-flex justify-content-between align-items-start mb-2">
												<strong>{{this.empName}}</strong>
												{{#if (eq this.status 'OPEN')}}
													<span class="badge bg-danger">Open</span>
												{{else if (eq this.status 'IN_PROGRESS')}}
													<span class="badge bg-warning">In Progress</span>
												{{else if (eq this.status 'RESOLVED')}}
													<span class="badge bg-success">Resolved</span>
												{{else}}
													<span class="badge bg-secondary">Closed</span>
												{{/if}}
											</div>
											<div class="small">
												<span class="badge bg-light text-dark">{{this.category}}</span>
												<span class="text-muted d-block mt-1">{{this.subject}}</span>
											</div>
											<small class="text-muted d-block mt-2">{{this.createdAt}}</small>
										</a>
										{{/each}}
									</div>
								{{else}}
									<div class="p-4 text-center text-muted">
										<i class="fa-solid fa-inbox" style="font-size: 32px; opacity: 0.3; display: block; margin-bottom: 10px;"></i>
										<p>No queries found</p>
									</div>
								{{/if}}
							</div>
						</div>
					</div>

					<!-- Query Details (Right Column) -->
					<div class="col-md-8">
						<div class="card" id="queryDetailsCard">
							<div class="card-body text-center text-muted py-5">
								<i class="fa-solid fa-select" style="font-size: 32px; opacity: 0.3; display: block; margin-bottom: 10px;"></i>
								<p>Select a query to view details</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
function selectQuery(id) {
	document.querySelectorAll('.query-item').forEach(el => el.classList.remove('active'));
	document.querySelector(`.query-item[data-id="${id}"]`).classList.add('active');

	// Sample query details
	const detailsHtml = `
		<div class="card-header">
			<div class="d-flex justify-content-between align-items-start">
				<div>
					<h6 class="mb-1">Salary Mismatch Query</h6>
					<small class="text-muted">from <strong>Rajesh Kumar</strong> (EMP-042)</small>
				</div>
				<span class="badge bg-warning">In Progress</span>
			</div>
		</div>

		<div class="card-body">
			<div class="mb-3">
				<strong>Category:</strong> <span class="badge bg-light text-dark">Salary Mismatch</span>
			</div>
			<div class="mb-3">
				<strong>Subject:</strong> December bonus not reflected in payslip
			</div>

			<hr>

			<h6 class="mb-3">Conversation</h6>
			<div style="max-height: 300px; overflow-y: auto; padding-right: 10px;">
				<!-- Employee Message -->
				<div class="mb-3">
					<div style="background: #f0f7ff; padding: 10px 12px; border-radius: 6px; border-left: 3px solid #4f46e5;">
						<div style="font-weight: 600; font-size: 13px; color: #4f46e5;">Rajesh Kumar</div>
						<div style="font-size: 13px; margin-top: 4px;">Hi, I received my December payslip but the monthly bonus of â‚¹5000 is not showing. Can you check?</div>
						<small class="text-muted d-block mt-2">Dec 28, 2025 at 10:30 AM</small>
					</div>
				</div>

				<!-- HR Reply -->
				<div class="mb-3">
					<div style="background: #f0fdf4; padding: 10px 12px; border-radius: 6px; border-left: 3px solid #22c55e;">
						<div style="font-weight: 600; font-size: 13px; color: #22c55e;">HR Manager</div>
						<div style="font-size: 13px; margin-top: 4px;">Hi Rajesh, Thank you for reporting this. I've checked with finance - the bonus was processed but may appear in January payslip due to processing delay. Will confirm in next 24 hrs.</div>
						<small class="text-muted d-block mt-2">Dec 29, 2025 at 2:15 PM</small>
					</div>
				</div>

				<!-- Employee Reply -->
				<div class="mb-3">
					<div style="background: #f0f7ff; padding: 10px 12px; border-radius: 6px; border-left: 3px solid #4f46e5;">
						<div style="font-weight: 600; font-size: 13px; color: #4f46e5;">Rajesh Kumar</div>
						<div style="font-size: 13px; margin-top: 4px;">Thank you for the update. I understand. Please let me know once it's confirmed.</div>
						<small class="text-muted d-block mt-2">Dec 29, 2025 at 3:45 PM</small>
					</div>
				</div>
			</div>

			<hr>

			<h6 class="mb-2">Internal Notes</h6>
			<textarea class="form-control form-control-sm mb-3" rows="2" placeholder="Add internal notes...">Confirmed with Finance - bonus will appear in January payout</textarea>

			<div class="row g-2">
				<div class="col-md-6">
					<button class="btn btn-success btn-sm w-100" onclick="resolveQuery()">
						<i class="fa-solid fa-check-circle me-1"></i>Mark as Resolved
					</button>
				</div>
				<div class="col-md-6">
					<button class="btn btn-outline-secondary btn-sm w-100" onclick="requestInfo()">
						<i class="fa-solid fa-comments me-1"></i>Request More Info
					</button>
				</div>
			</div>
		</div>
	`;

	document.getElementById('queryDetailsCard').innerHTML = detailsHtml;
}

function filterQueries() {
	showToast('Filters applied', 'info');
}

function resetFilters() {
	document.querySelectorAll('select').forEach(sel => sel.value = '');
	showToast('Filters reset', 'info');
}

function resolveQuery() {
	showToast('Query marked as resolved!', 'success');
}

function requestInfo() {
	showToast('Request for more information sent!', 'success');
}

function showToast(message, type = 'info') {
	const alertDiv = document.createElement('div');
	alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
	alertDiv.setAttribute('role', 'alert');
	alertDiv.innerHTML = `
		${message}
		<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
	`;
	document.querySelector('.main-content').insertAdjacentElement('afterbegin', alertDiv);
	setTimeout(() => alertDiv.remove(), 4000);
}
</script>

<style>
.query-item {
	transition: all 150ms ease;
}

.query-item:hover {
	background: #f8f9fa;
}

.query-item.active {
	background: #e0e7ff;
	border-left: 3px solid #4f46e5;
}
</style>
